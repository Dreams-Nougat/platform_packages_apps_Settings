Revision: 4d44fac3cc042a2e2dd12a8f24ca624100568293
Patch-set: 1
File: src/com/android/settings/ZonePicker.java

262
Fri Jun 05 15:16:52 2015 +0000
Author: Elliott Hughes <1003224@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 19afe490_81f3a098
Bytes: 40
won't this always be true because of AU?

262
Fri Jun 05 15:20:17 2015 +0000
Author: Neil Fuller <1038039@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 19afe490_81f3a098
UUID: 19afe490_e1b8dcb4
Bytes: 238
It will be true for AU's data, false for others (e.g. UK, not checked China because I lack the language).

This logic is run every time the list is generated so it depends on the user's locale (which affects the contents of localZoneIds).

262
Fri Jun 05 16:13:42 2015 +0000
Author: Elliott Hughes <1003224@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 19afe490_e1b8dcb4
UUID: 39b828d4_c20598c6
Bytes: 1058
oh, because the Settings list doesn't contain all the AU zones, but L246-249 adds them _if_ your locale is AU. maybe rewrite the L246 comment to something like "all the time zones used in the user's locale, whether they're in Settings' list or not"?

i guess i'm just surprised that some ambiguous time zones affect the display of _all_ time zones. i literally meant something like

  if (locale.getCountry().equals("AU") && TimeZoneNames.forLocale(locale).contains(olsonId)) // use examplar...

then when i read your checkin comment i thought you were going to do something cleverer where you'd drop the equals("AU") and just say "if the user's country has ambiguity, avoid it" which sounds good. but i'm having trouble working out whether "if any country has ambiguity, avoid it for all countries" is different. i'm now leaning towards it *not* being different because other countries were already using examplars, so only the user's country can be affected by this.

but that was too subtle for my little brain, so i'd definitely add a comment explaining.

262
Fri Jun 05 16:49:28 2015 +0000
Author: Neil Fuller <1038039@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 39b828d4_c20598c6
UUID: 39b828d4_a2226430
Bytes: 958
I started by special casing "AU" but as mentioned I didn't like the special casing. The rule will apply where there's ambiguity, and AU triggers that.

246-249 has no effect on the final list. We always output all entries we were told to by the config. The only question is whether we display the "long name" or the "exemplar location" for the local olsonIds.

Agree the logic below is confusing. I think because "use  location" is actually the common/default case.

The way I thought about it was:

exemplar location used when: "olsonId is non local" OR ("olson id is local" (implied) AND longNamesAreAmbiguous)

I flipped the order of the preferLocationDisplayName check because the longNamesAreAmbiguous check is cheapest. Most cases it *will* be false, though so we'll fall through to "is local". It should still mean that the only time we use the long name is when the timezone is local AND long names ARE NOT ambiguous.

I'll look at making it clearer.

